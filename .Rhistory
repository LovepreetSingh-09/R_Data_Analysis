"Republican, weak" = "Not str republican",
"Independent, near rep" = "Ind,near rep",
"Independent, near dem" = "Ind,near dem",
"Democrat, weak" = "Not str democrat",
"Democrat, strong" = "Strong democrat"
)) %>%
count(partyid)
# Modifying Values
gss_cat %>% count(partyid)
gss_cat %>% mutate(partyid = fct_recode(partyid,
"Republican, strong" = "Strong republican",
"Republican, weak" = "Not str republican",
"Independent, near rep" = "Ind,near rep",
"Independent, near dem" = "Ind,near dem",
"Democrat, weak" = "Not str democrat",
"Democrat, strong" = "Strong democrat" )) %>%
count(partyid)
# We can also combine groups or collapse using fct_recode
gss_cat %>% mutate(partyid = fct_recode(partyid,
"Republican, strong" = "Strong republican",
"Republican, weak" = "Not str republican",
"Independent, near rep" = "Ind,near rep",
"Independent, near dem" = "Ind,near dem",
"Democrat, weak" = "Not str democrat",
"Democrat, strong" = "Strong democrat",
"Other" = "No answer",
"Other" = "Don't know",
"Other" = "Other party")) %>%
count(partyid)
gss_cat %>%mutate(partyid = fct_collapse(partyid,
other = c("No answer", "Don't know", "Other party"),
rep = c("Strong republican", "Not str republican"),
ind = c("Ind,near rep", "Independent", "Ind,near dem"),
dem = c("Not str democrat", "Strong democrat"))) %>%
count(partyid)
# fct_lump combines or lump the all small groups together
gss_cat %>%
mutate(relig = fct_lump(relig)) %>%
count(relig)
count(relig)
# give n value to decide the total no. of groups after lump
gss_cat %>%
mutate(relig = fct_lump(relig, n = 10)) %>%
count(relig, sort = TRUE) %>%
print(n = Inf)
now()
library(tidyverse)
library(lubridate)
library(nycflights13)
now()
today()
ymd(20190507)
ymd('28 February,2019')
ymd('28st February,2019')
dmy('28st February,2019')
# For creating dates with time
ymd_hms(201907058000)
# For creating dates with time
ymd_hms(20190705 8000)
# For creating dates with time
ymd_hms(20190705 )
# For creating dates with time
ymd_hms(20190705)
# For creating dates with time
ymd_hms(20190705 20:11:00)
# For creating dates with time
ymd_hms('20190705 20:11:00')
ymd_hms('20190705 20:11')
ymd_hm('20190705 20:11')
ymd_hm('20190705 20:11:05')
ymd_hm('20190705 20:11')
?tz
tz()
?
?tz
?tz
ymd_hm('20190705 20:11',tz='UTC')
ymd_hm('20190705 20:11',tz='New_Delhi')
ymd_hm('20190705 20:11',tz='Mumbai')
ymd_hm('20190705 20:11',tz='Asia/Mumbai')
ymd_hm('20190705 20:11',tz='Asia/Delhi')
ymd_hm('20190705 20:11',tz='NZ')
ymd_hm('20190705 20:11',tz='IN')
ymd_hm('20190705 20:11',tz='IND')
ymd_hm('20190705 20:11',tz='IST')
base::Sys.timezone()
base::timezones()
ymd_hm('20190705 20:11',tz='Asia')
ymd_hm('20190705 20:11',tz='Asia/Calcutta')
ymd_hm('20190705 20:11',tz='Asia/Delhi')
ymd_hm('20190705 20:11',tz='Asia/New_Delhi')
ymd_hm('20190705 20:11',tz='Asia/Mumbai')
ymd_hm('20190705 20:11',tz='IN')
ymd_hm('20190705 20:11',tz='Asia/Kolkata')
base::timezones()
flights %>%
select(year, month, day, hour, minute)
fl=flights %>%
select(year, month, day, hour, minute)
fl %>% mutate(make_datetime())
fl %>% mutate(dep_time=make_datetime(f1))
fl %>% mutate(dep_time=make_datetime(.))
fl %>% mutate(dep_time=make_datetime(year,month,day,hour,minute))
make_datetime_100 <- function(year, month, day, time) {
make_datetime(year, month, day, time %/% 100, time %% 100)
}
flights
flights_dt <- flights %>% select(!is.na(dep_time),!is.na(arr_time))
flights_dt <- flights %>% select(!is.na(dep_time),!is.na(arr_time))
flights_dt <- flights %>% filter(!is.na(dep_time),!is.na(arr_time))
flights_dt <- flights %>% filter(!is.na(dep_time),!is.na(arr_time)) %>%
mutate(dep_time=make_datetime_100(year,month,day,dep_time),
arr_time = make_datetime_100(year, month, day, arr_time),
sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),
sched_arr_time = make_datetime_100( year, month, day, sched_arr_time)) %>%
select(origin,dest,ends_with('time'),ends_with('delay'))
flights_dt
flights_dt <- flights %>% filter(!is.na(dep_time),!is.na(arr_time)) %>%
mutate(dep_time=make_datetime_100(year,month,day,dep_time),
arr_time = make_datetime_100(year, month, day, arr_time),
sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),
sched_arr_time = make_datetime_100( year, month, day, sched_arr_time)) %>%
select(origin,dest,ends_with('delay'),ends_with('time'))
flights_dt
ggplot(flights_dt,aes(dep_time)) %>%
geom_freqpoly(binwidth=86400) # 86400=no. of seconds in a day
ggplot(flights_dt,aes(dep_time)) +
geom_freqpoly(binwidth=86400) # 86400=no. of seconds in a day
ggplot(flights_dt,aes(dep_time)) +
geom_freqpoly(binwidth=365)
slights %>% filter(dep_time=ymd(20130728)) %>%
ggplot(aes(dep_time)) +
geom_freqpoly(binwidth=60)
fllights_dt %>% filter(dep_time=ymd(20130728)) %>%
ggplot(aes(dep_time)) +
geom_freqpoly(binwidth=60)
flights_dt %>% filter(dep_time=ymd(20130728)) %>%
ggplot(aes(dep_time)) +
geom_freqpoly(binwidth=60)
flights_dt %>% filter(dep_time==ymd(20130728)) %>%
ggplot(aes(dep_time)) +
geom_freqpoly(binwidth=60)
flights_dt %>% filter(dep_time==ymd(20130728)) %>%
ggplot(aes(dep_time)) +
geom_freqpoly(binwidth=600)
flights_dt %>% filter(dep_time==ymd(20130728))
flights_dt %>% filter(dep_time==ymd(20130718))
flights_dt
flights_dt %>% filter(dep_time==ymd(20130728))
flights_dt %>% filter(dep_time==ymd(20131109))
ymd(20131109)
flights_dt %>% filter(dep_time==ymd(20130507))
flights_dt %>% filter(dep_time<ymd(20130507))
flights_dt %>% filter(dep_time=ymd(20130728))
flights_dt %>% filter(dep_time==ymd(20130728))
flights_dt %>% filter(dep_time==ymd(20130101))
flights_dt %>% filter(between(ymd(20130728),ymd(20130729)))
flights_dt %>% filter(between(ymd(20130728),ymd(20130729),100))
flights_dt %>% filter(dep_time=starts_with(ymd(20130728)))
flights_dt %>% filter(dep_time==starts_with(ymd(20130728)))
flights_dt %>% filter(starts_with(ymd(20130728)))
flights_dt %>% filter(dep_time>(ymd(20130728)))
flights_dt %>% filter(dep_time>(ymd(20130728)& dep_time<ymd(20130729)))
flights_dt %>% filter(dep_time>(ymd(20130728) & dep_time<ymd(20130729)))
flights_dt %>% filter(dep_time>(ymd(20130728) && dep_time<ymd(20130729)))
flights_dt %>% filter(dep_time>(ymd(20130728) & dep_time<ymd(20130729)))
flights_dt %>% filter(dep_time>(ymd(20130728) %&% dep_time<ymd(20130729)))
flights_dt %>% filter(dep_time>(ymd(20130728)& dep_time<ymd(20130729)))
flights_dt %>% filter(dep_time(starts_with=ymd(20130728)))
flights_dt %>% filter(dep_time=starts_with=ymd(20130728))
flights_dt %>% filter(dep_time=starts_with(ymd(20130728)))
flights_dt %>% filter(dep_time==starts_with(ymd(20130728)))
flights_dt %>% filter(dep_time==ymd(20130728))
flights_dt %>% filter(dep_time>ymd(20130728) & dep_time<ymd(20130729))
flights_dt %>% filter(dep_time>ymd(20130728) & dep_time<ymd(20130729)) %>%
ggplot(aes(dep_time)) +
geom_freqpoly(binwidth=600)
as_datetime(today())
source('~/R/R_Data_Analysis/Date_Time.R')
source('~/R/R_Data_Analysis/Date_Time.R')
as_datetime(today())
as_date(now())
# Count from 1970
as_datetime(1)
# Count from 1970-0-01 00:00:00 UTC
as_datetime(60*60*24*5)
as_date(365*10+2)
datetime <- ymd_hms("2016-07-08 12:34:56")
year(datetime)
month(datetime)
mday(datetime)
yday(datetime)
wday(datetime)
month(datetime,labels=T)
month(datetime,labels=TRUE)
month(datetime,label=TRUE)
month(datetime,lbels=TRUE,attr=FALSE)
month(datetime,lbels=TRUE,abbr=FALSE)
month(datetime,labels=TRUE,abbr=FALSE)
month(datetime,label=TRUE,abbr=FALSE)
flights%>% mutate(wday=wday(dep_time,label=TRUE)) %>%
ggplot(aes(wday))+
geom_bar()
flights_dt %>% mutate(wday=wday(dep_time,label=TRUE)) %>%
ggplot(aes(x=wday))+
geom_bar()
flights_dt %>% mutate(minute = minute(dep_time)) %>%
group_by(minute) %>% summarize(avg_delay = mean(arr_delay, na.rm = TRUE), n = n()) %>%
ggplot(aes(minute, avg_delay)) +
geom_line()
sched_dep <- flights_dt %>% mutate(minute = minute(sched_dep_time)) %>%
group_by(minute) %>% summarize(avg_delay = mean(arr_delay, na.rm = TRUE), n = n())
ggplot(sched_dep, aes(minute, avg_delay)) +
geom_line()
ggplot(sched_dep, aes(minute, n)) +
geom_line()
flights_dt %>%
count(week = floor_date(dep_time, "week")) %>%
ggplot(aes(week, n)) +
geom_line()
floor_date(flights_dt,dep_time, "week")
flights_dt %>% floor_date(dep_time, "week")
flights_dt %>% floor_date(dep_time, "week")
flights_dt %>%
count(week = floor_date(dep_time, "week"))
# Each ceiling_date()function takes a vector of dates to adjust and then the name of t
# he unit to round down (floor), round up (ceiling), or round to.
flights_dt %>%
count(week = floor_date(dep_time, "week"))
flights_dt %>%
count(week = floor_date(dep_time, "week")) %>%
ggplot(aes(week, n)) +
geom_line()
datetime <- ymd_hms("2016-07-08 12:34:56")
year(datetime) <- 2020
datetime
month(datetime) <- 01
datetime
hour(datetime) <- hour(datetime) + 1
update(datetime,year=2021,month=07,mday=28,hour=00)
ymd("2015-02-01") %>%
update(mday = 30)
ymd("2015-02-01") %>% update(hour = 400)
# Dep_time of flights on the 1st day of the year
flights_dt %>%
mutate(dep_hour = update(dep_time, yday = 1)) %>%
ggplot(aes(dep_hour)) +
geom_freqpoly(binwidth = 300)
# Calculating Durations
h_age <- today() - ymd(19791014)
h_age
as.duration(h_age)
dseconds(15)
dminutes(10)
dhours(c(12, 24))
ddays(0:5)
dweeks(3)
dyears(1)
2 * dyears(1)
dyears(1) + dweeks(12) + dhours(15)
tomorrow <- today() + ddays(1)
last_year <- today() - dyears(1)
one_pm <- ymd_hms(
"2016-03-12 13:00:00",
tz = "Asia/kolkata")
one_pm
one_pm + ddays(1)
one_pm <- ymd_hms(
"2016-03-12 13:00:00",
tz = "America/New_York")
one_pm
one_pm + ddays(1)
#bTo solve this use Periods
one_pm
one_pm + days(1)
seconds(15)
minutes(10)
hours(c(12, 24))
days(7)
months(1:6)
weeks(3)
years(1)
10 * (months(6) + days(1))
10 * (months(6) + days(1))
ymd("2016-01-01") + dyears(1)
ymd("2016-01-01") + years(1)
ymd("2016-01-01") + years(1)
one_pm + ddays(1)
one_pm + days(1)
flights_dt %>%
filter(arr_time < dep_time)
flights_dt %>%
filter(arr_time > dep_time)
<
flights_dt %>%
filter(arr_time < dep_time)
flights_dt <- flights_dt %>%
mutate(overnight = arr_time < dep_time,
arr_time = arr_time + days(overnight * 1),
sched_arr_time = sched_arr_time + days(overnight * 1))
sched_arr_time = sched_arr_time + days(overnight * 1)
flights_dt %>%
mutate(overnight = arr_time < dep_time,
arr_time = arr_time + days(overnight * 1),
sched_arr_time = sched_arr_time + days(overnight * 1))
flights_dt %>%
filter(overnight, arr_time < dep_time)
# intervals
years(1) / days(1)
next_year <- today() + years(1)
(today() %--% next_year) / ddays(1)
(today() %--% next_year) %/% days(1)
Sys.timezone()
length(OlsonNames())
head(OlsonNames())
OlsonNames()
(x1 <- ymd_hms("2015-06-01 12:00:00", tz = "America/New_York"))
(x2 <- ymd_hms("2015-06-01 18:00:00", tz = "Europe/Copenhagen"))
(x3 <- ymd_hms("2015-06-02 04:00:00", tz = "Pacific/Auckland"))
x1 - x2
x1 - x3
x4 <- c(x1, x2, x3)
x4
x4a <- with_tz(x4, tzone = "Australia/Lord_Howe")
x4a
x4a-x4
# force_tz() makes difference in different timezones
x4b <- force_tz(x4, tzone = "Australia/Lord_Howe")
x4b
x4b-x4
source('~/.active-rstudio-document')
library(lubridate)
library(nycflights13)
rnorm(100) %>%
matrix(ncol = 2) %>%
plot() %>%
str()
rnorm(100) %>%
matrix(ncol = 2) %>%
plot() %>%
str()
rnorm(100) %>%
matrix(ncol = 2) %>%
plot() %>%
str()
rnorm(100) %>%
matrix(ncol=2)%T>%
plot() %>%
str()
rnorm(100) %>%
matrix(ncol=2)%T>%
plot() %>%
str()
rnorm(100) %>%
matrix(ncol=2)%T>%
plot() %>%
str()
mtcars %$%
cor(disp, mpg)
mtcars %$%
cor(disp, mpg)
library(magittr)
library(magittar)
library(magrittr)
rnorm(100) %>%
matrix(ncol = 2) %>%
plot() %>%
str()
# %T>% returns the lefthand side object of it instead of righthandsize to the next upcming object
the righthand side.
# %T>% returns the lefthand side object of it instead of righthandsize to the next upcming object
rnorm(100) %>%
matrix(ncol=2)%T>%
plot() %>%
str()
mtcars %$%
cor(disp, mpg)
mtcars %>%
cor(disp, mpg)
mtcars$disp
mtcars$mpg
plot.default(mtcars$disp,mtcars$mpg)
mtcars %$%
(disp, mpg)
mtcars %>%
(disp, mpg)
mtcars %>% (disp, mpg)
mtcars %>% (disp,mpg)
mtcars
mtcars=as_tibble(mtcars)
mtcars
mtcars %>% (disp,mpg)
mtcars %>%
(disp,mpg)
mtcars %>%
filter(disp,mpg)
mtcars$disp
mtcars$mpg
plot.default(mtcars$disp,mtcars$mpg)
x <- c(1:10, Inf)
rescale01(x)
rescale01 <- function(x) {
rng <- range(x, na.rm = TRUE)
(x - rng[1]) / (rng[2] - rng[1])
}
x <- c(1:10, Inf)
rescale01(x)
range(2:20)
x <- c(1:10, Inf)
rescale01(x)
# load --------------------------------------------------------------------
identical(0L, 0)
source('~/R/R_Data_Analysis/Pipes_and_Functions.R')
object.size(mtcars)
wt_mean <- function(x, w, na.rm = FALSE) {
stopifnot(is.logical(na.rm), length(na.rm) == 1)
stopifnot(length(x) == length(w))
if (na.rm) {
miss <- is.na(x) | is.na(w)
x <- x[!miss]
w <- w[!miss]
}
sum(w * x) / sum(x)
}
wt_mean(1:6, 6:1, na.rm = "foo")
rule <- function(..., pad = "-") {
title <- paste0(...)
width <- getOption("width") - nchar(title) - 5
cat(title, " ", stringr::str_dup(pad, width), "\n", sep = "")
}
rule("Important output")
sum(x, na.mr = TRUE)
x <- c(1, 2)
sum(x, na.mr = TRUE)
?na.mr
x <- c(2, 2)
sum(x, na.mr = TRUE)
x <- c(1, 2)
sum(x, na.mr = TRUE)
x <- c(3, 2)
sum(x, na.mr = TRUE)
x <- c(4, 2)
sum(x, na.mr = TRUE)
x <- c(1, 2)
sum(x, na.mr = TRUE)
x <- c(2, 2)
sum(x, na.mr = TRUE)
x <- c(5, 2)
sum(x, na.mr = TRUE)
x <- c(6, 2)
sum(x, na.mr = TRUE)
mean(x, na.mr = TRUE)
max(x, na.mr = TRUE)
exp(x, na.mr = TRUE)
sub(x, na.mr = TRUE)
mean(x, na.mr = TRUE)
n <- sum(is.na(df))
show_missings <- function(df) {
n <- sum(is.na(df))
cat("Missing values: ", n, "\n", sep = "")
invisible(df)
}
x <- show_missings(mtcars)
class(x)
dim(x)
# add some NA values
mtcars %>%
show_missings() %>%
mutate(mpg = ifelse(mpg < 20, NA, mpg)) %>%
show_missings()
y <- 100
f(10)
f <- function(x) {
x + y
}
y <- 100
f(10)
y <- 1000
f(10)
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
library(tidyverse)
library(lubridate)
library(nycflights13)
library(magrittr)
typeof(1)
typeof(1L)
c(-1, 0, 1) / 0
x <- "This is a reasonably long string."
pryr::object_size(x)
y <- rep(x, 1000)
install.packages("pryr")
typeof(c(TRUE, 1L))
# Always the most complex type is taken by the vector
typeof(c(1L, 1.5))
x <- "This is a reasonably long string."
pryr::object_size(x)
y <- rep(x, 1000)
pryr::object_size(y)
library(pryr)
x <- "This is a reasonably long string."
pryr::object_size(x)
y <- rep(x, 1000)
pryr::object_size(y)
1:10 + 1:3
tibble(x = 1:4, y = rep(1:2, 2))
tibble(x = 1:4, y = rep(1:2, each = 2))
x <- c("one", "two", "three", "four", "five")
x[c(3, 2, 5)]
x[c(1, 1, 5, 5, 5, 2)]
x <- c(abc = 1, def = 2, xyz = 5)
x[c("xyz", "def")]
